---
import { render } from "astro:content";
import { type CollectionEntry, getCollection } from "astro:content";

import BlogPost from "$layouts/BlogPost.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const postsZh = new Map(
    (await getCollection("blog-zh")).map((p) => [p.id, p])
  );

  return posts.map((post) => ({
    params: { slug: post.id },
    props: {
      canonical: post,
      specific: postsZh.get(post.id),
    },
  }));
}
type Props = {
  canonical: CollectionEntry<"blog">;
  specific: CollectionEntry<"blog-zh"> | undefined;
};

const postAll = Astro.props;
const post = postAll.specific || postAll.canonical;
const canonical = Astro.url.pathname.replace(/\/zh\//, "/");
const { Content } = await render(post);
---

<BlogPost {...{ id: post.id, breadcrumbs: "Posts", canonical }} {...post.data}>
  <Content />
</BlogPost>
